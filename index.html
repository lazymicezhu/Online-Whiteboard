<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šäººåœ¨çº¿åƒç´ æ¶‚é¸¦ç™½æ¿</title>
    <link rel="stylesheet" href="styles/main.css">
    
    <!-- Firebaseç›¸å…³è„šæœ¬ -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
    
    <!-- å…ˆåŠ è½½é…ç½®è„šæœ¬ç¡®ä¿Firebaseåˆå§‹åŒ– -->
    <script src="scripts/config.js"></script>
</head>
<body>
    <div id="app">
        <!-- ç™»å½•/æ³¨å†Œç•Œé¢ -->
        <div id="auth-container" class="container">
            <h1>å¤šäººåœ¨çº¿åƒç´ æ¶‚é¸¦ç™½æ¿</h1>
            <div class="auth-tabs">
                <button id="login-tab-btn" class="auth-tab active">ç™»å½•</button>
                <button id="register-tab-btn" class="auth-tab">æ³¨å†Œ</button>
            </div>
            
            <!-- ç™»å½•è¡¨å• -->
            <div id="login-form" class="auth-form">
                <h2>ç™»å½•</h2>
                <div class="input-group">
                    <label for="login-nickname">æ˜µç§°</label>
                    <input type="text" id="login-nickname" placeholder="è¯·è¾“å…¥æ˜µç§°">
                </div>
                <div class="input-group">
                    <label for="login-password">å¯†ç </label>
                    <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <button id="login-submit-btn">ç™»å½•</button>
                <p class="switch-form-text">æ²¡æœ‰è´¦å·ï¼Ÿ<a href="#" id="switch-to-register">ç«‹å³æ³¨å†Œ</a></p>
                <p id="login-status" style="color: red; margin-top: 10px;"></p>
            </div>
            
            <!-- æ³¨å†Œè¡¨å• -->
            <div id="register-form" class="auth-form hidden">
                <h2>æ³¨å†Œæ–°è´¦å·</h2>
                <div class="input-group">
                    <label for="register-nickname">æ˜µç§°</label>
                    <input type="text" id="register-nickname" placeholder="è¯·è¾“å…¥æ˜µç§°">
                </div>
                <div class="input-group">
                    <label for="register-password">å¯†ç </label>
                    <input type="password" id="register-password" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <div class="avatar-selection">
                    <label>é€‰æ‹©å¤´åƒ</label>
                    <div class="avatar-options">
                        <img src="assets/avatar1.png" class="avatar-option" data-avatar="1" alt="å¤´åƒ1">
                        <img src="assets/avatar2.png" class="avatar-option" data-avatar="2" alt="å¤´åƒ2">
                        <img src="assets/avatar3.png" class="avatar-option" data-avatar="3" alt="å¤´åƒ3">
                    </div>
                </div>
                <button id="register-submit-btn">æ³¨å†Œå¹¶å¼€å§‹åˆ›ä½œ</button>
                <p class="switch-form-text">å·²æœ‰è´¦å·ï¼Ÿ<a href="#" id="switch-to-login">ç«‹å³ç™»å½•</a></p>
                <p id="register-status" style="color: red; margin-top: 10px;"></p>
            </div>
        </div>

        <!-- ä¸»ç”»å¸ƒç•Œé¢ -->
        <div id="main-container" class="container hidden">
            <div class="header">
                <div class="user-info">
                    <img id="user-avatar" src="" alt="ç”¨æˆ·å¤´åƒ">
                    <span id="user-nickname"></span>
                    <span id="user-type"></span>
                </div>
                <div class="online-users-ticker">
                    <div class="ticker-wrapper">
                        <div id="online-users-scroll"></div>
                    </div>
                </div>
                <div class="drawing-info">
                    <span id="remaining-draws">å‰©ä½™æ“ä½œæ¬¡æ•°: 60</span>
                    <span id="timer">åˆ·æ–°æ—¶é—´: 60ç§’</span>
                </div>
                <button id="logout-btn">é€€å‡º</button>
                <button id="admin-panel-btn" class="hidden">ç®¡ç†å‘˜é¢æ¿</button>
            </div>

            <div class="content">
                <!-- æµ®åŠ¨å·¥å…·é¢æ¿ -->
                <div class="floating-tools-panel">
                    <div class="panel-header">
                        <h3>å·¥å…·ç®±</h3>
                        <button id="minimize-panel" title="æœ€å°åŒ–é¢æ¿"><i class="minimize-icon">â€”</i></button>
                    </div>
                    <div class="panel-content">
                        <div class="color-picker">
                            <h4>é€‰æ‹©é¢œè‰²</h4>
                            <div class="colors-container">
                                <div class="color-option" data-color="#000000" style="background-color: #000000;"></div>
                                <div class="color-option" data-color="#FFFFFF" style="background-color: #FFFFFF;"></div>
                                <div class="color-option" data-color="#FF0000" style="background-color: #FF0000;"></div>
                                <div class="color-option" data-color="#00FF00" style="background-color: #00FF00;"></div>
                                <div class="color-option" data-color="#0000FF" style="background-color: #0000FF;"></div>
                                <div class="color-option" data-color="#FFFF00" style="background-color: #FFFF00;"></div>
                                <div class="color-option" data-color="#00FFFF" style="background-color: #00FFFF;"></div>
                                <div class="color-option" data-color="#FF00FF" style="background-color: #FF00FF;"></div>
                                <div class="color-option" data-color="#FFA500" style="background-color: #FFA500;"></div>
                                <div class="color-option" data-color="#800080" style="background-color: #800080;"></div>
                                <div class="color-option" data-color="#A52A2A" style="background-color: #A52A2A;"></div>
                                <div class="color-option" data-color="#008000" style="background-color: #008000;"></div>
                            </div>
                            <div class="current-color-preview">
                                <div id="current-color"></div>
                                <span>å½“å‰é¢œè‰²</span>
                            </div>
                        </div>
                        <div class="tools">
                            <h4>ç»˜å›¾å·¥å…·</h4>
                            <div class="tools-container">
                                <button id="draw-tool" class="tool active" data-tool="draw">ç»˜åˆ¶</button>
                                <button id="erase-tool" class="tool" data-tool="erase">æ“¦é™¤</button>
                            </div>
                        </div>
                        <div class="brush-size">
                            <h4>ç”»ç¬”ç²—ç»†</h4>
                            <div class="brush-options">
                                <button class="brush-option active" data-size="1">
                                    <div class="brush-preview" style="width: 1px; height: 1px;"></div>
                                    <span>1px</span>
                                </button>
                                <button class="brush-option" data-size="2">
                                    <div class="brush-preview" style="width: 2px; height: 2px;"></div>
                                    <span>2px</span>
                                </button>
                                <button class="brush-option vip-only" data-size="3">
                                    <div class="brush-preview" style="width: 3px; height: 3px;"></div>
                                    <span>3px</span>
                                    <span class="restriction-badge">VIP</span>
                                </button>
                                <button class="brush-option vip-only" data-size="4">
                                    <div class="brush-preview" style="width: 4px; height: 4px;"></div>
                                    <span>4px</span>
                                    <span class="restriction-badge">VIP</span>
                                </button>
                                <button class="brush-option admin-only" data-size="5">
                                    <div class="brush-preview" style="width: 5px; height: 5px;"></div>
                                    <span>5px</span>
                                    <span class="restriction-badge">ç®¡ç†å‘˜</span>
                                </button>
                            </div>
                        </div>
                        <div class="canvas-zoom">
                            <h4>ç”»å¸ƒç¼©æ”¾</h4>
                            <div class="zoom-controls">
                                <button id="zoom-out" class="zoom-btn" onclick="if(window.canvasManager){window.canvasManager.zoomLevel=Math.max(0.5,parseFloat((window.canvasManager.zoomLevel-0.1).toFixed(1)));this.nextElementSibling.textContent=Math.round(window.canvasManager.zoomLevel*100)+'%';document.getElementById('pixel-canvas').style.transform=`translate(-50%, -50%) scale(${window.canvasManager.zoomLevel})`;window.canvasManager.drawCanvasBorder();localStorage.setItem('canvasZoom',window.canvasManager.zoomLevel.toString());}">-</button>
                                <span id="zoom-level">100%</span>
                                <button id="zoom-in" class="zoom-btn" onclick="if(window.canvasManager){window.canvasManager.zoomLevel=Math.min(3,parseFloat((window.canvasManager.zoomLevel+0.1).toFixed(1)));this.previousElementSibling.textContent=Math.round(window.canvasManager.zoomLevel*100)+'%';document.getElementById('pixel-canvas').style.transform=`translate(-50%, -50%) scale(${window.canvasManager.zoomLevel})`;window.canvasManager.drawCanvasBorder();localStorage.setItem('canvasZoom',window.canvasManager.zoomLevel.toString());}">+</button>
                                <button id="zoom-reset" class="zoom-btn" onclick="if(window.canvasManager){window.canvasManager.zoomLevel=1;document.getElementById('zoom-level').textContent='100%';document.getElementById('pixel-canvas').style.transform='translate(-50%, -50%) scale(1)';window.canvasManager.drawCanvasBorder();localStorage.setItem('canvasZoom','1');}">é‡ç½®</button>
                            </div>
                        </div>
                    </div>
                    <!-- æœ€å°åŒ–åçš„é¢æ¿ -->
                    <div class="minimized-panel hidden">
                        <button id="expand-panel" title="å±•å¼€é¢æ¿"><i class="expand-icon">+</i></button>
                        <div id="mini-color" class="mini-tool"></div>
                        <div id="mini-brush" class="mini-tool"></div>
                    </div>
                </div>
                <div class="main-workspace">
                    <div class="canvas-container">
                        <canvas id="pixel-canvas"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†å‘˜é¢æ¿ -->
        <div id="admin-panel" class="container hidden">
            <h2>ç®¡ç†å‘˜é¢æ¿</h2>
            <div class="admin-content">
                <div class="users-management">
                    <h3>ç”¨æˆ·ç®¡ç†</h3>
                    <div class="search-box">
                        <input type="text" id="search-user" placeholder="æœç´¢ç”¨æˆ·...">
                    </div>
                    <table id="users-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>æ˜µç§°</th>
                                <th>ç±»å‹</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body"></tbody>
                    </table>
                </div>
                
                <div class="canvas-management">
                    <h3>ç”»å¸ƒç®¡ç†</h3>
                    <div class="canvas-size-control">
                        <div class="size-control-group">
                            <label for="canvas-width">ç”»å¸ƒå®½åº¦ (åƒç´ ):</label>
                            <input type="number" id="canvas-width" min="500" max="3000" step="100" value="1000">
                        </div>
                        <div class="size-control-group">
                            <label for="canvas-height">ç”»å¸ƒé«˜åº¦ (åƒç´ ):</label>
                            <input type="number" id="canvas-height" min="500" max="3000" step="100" value="1000">
                        </div>
                        <button id="apply-canvas-size">åº”ç”¨æ–°å°ºå¯¸</button>
                        <p class="canvas-size-warning">è­¦å‘Šï¼šå‡å°ç”»å¸ƒå°ºå¯¸å¯èƒ½ä¼šå¯¼è‡´è¾¹ç¼˜åƒç´ ä¸¢å¤±ï¼</p>
                    </div>
                    
                    <div class="brush-size-control">
                        <h4>ç”»ç¬”ç²—ç»†è®¾ç½®</h4>
                        <div class="brush-control-group">
                            <label for="max-brush-size">æœ€å¤§ç”»ç¬”ç²—ç»† (åƒç´ ):</label>
                            <input type="number" id="max-brush-size" min="5" max="20" step="1" value="5">
                        </div>
                        <div class="brush-options-preview">
                            <h5>å¯ç”¨ç”»ç¬”é€‰é¡¹é¢„è§ˆ:</h5>
                            <div id="brush-size-preview" class="brush-size-preview">
                                <!-- è¿™é‡Œå°†åŠ¨æ€ç”Ÿæˆé¢„è§ˆå†…å®¹ -->
                            </div>
                        </div>
                        <button id="apply-brush-size">åº”ç”¨æ–°ç”»ç¬”è®¾ç½®</button>
                        <p class="brush-size-note">æ³¨æ„ï¼šæ›´å¤§çš„ç”»ç¬”å¯èƒ½ä¼šå¯¼è‡´ç»˜åˆ¶æ€§èƒ½ä¸‹é™</p>
                    </div>
                </div>
                
                <div class="admin-actions">
                    <button id="back-to-canvas">è¿”å›ç”»å¸ƒ</button>
                </div>
            </div>
        </div>
        
        <!-- èŠå¤©æ‚¬æµ®çƒ -->
        <div class="chat-floating-ball">
            <div class="chat-ball" id="chat-ball">
                <span class="unread-badge hidden">0</span>
                <i class="chat-icon">ğŸ’¬</i>
            </div>
            
            <div class="chat-container hidden">
                <div class="chat-header">
                    <h3>èŠå¤©å®¤</h3>
                    <button id="minimize-chat" title="æœ€å°åŒ–èŠå¤©"><i class="minimize-icon">âœ•</i></button>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <div class="system-message">æ¬¢è¿æ¥åˆ°èŠå¤©å®¤ï¼è¯·å‹å–„äº¤æµã€‚</div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." maxlength="100">
                    <button id="send-message">å‘é€</button>
                </div>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰è„šæœ¬ - å…ˆåŠ è½½ç®¡ç†æ¨¡å—å†åŠ è½½ä¸»é€»è¾‘ -->
    <script src="scripts/admin.js"></script>
    <script src="scripts/user.js"></script>
    <script src="scripts/canvas.js"></script>
    <script src="scripts/chat.js"></script>
    <script src="scripts/main.js"></script>
    
    <!-- ç¡®ä¿æ‰€æœ‰æ¨¡å—å®ä¾‹åŒ– -->
    <script>
        // æ£€æŸ¥å¹¶ç¡®ä¿å…¨å±€å¯¹è±¡å®ä¾‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log("æ£€æŸ¥å…¨å±€å¯¹è±¡å®ä¾‹åŒ–...");
            
            // å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½å·²åŠ è½½
            setTimeout(function() {
                try {
                    // æ£€æŸ¥Firebaseåˆå§‹åŒ–çŠ¶æ€
                    if (!firebase.apps.length) {
                        console.error("Firebaseæœªåˆå§‹åŒ–!");
                        
                        // å°è¯•æ‰‹åŠ¨åˆå§‹åŒ–
                        const firebaseConfig = {
                            apiKey: "AIzaSyD4FhGQNWQjlg6YAW9Mh3jHn3jLenNF5U0",
                            authDomain: "lazymice-web-game.firebaseapp.com",
                            projectId: "lazymice-web-game",
                            storageBucket: "lazymice-web-game.firebasestorage.app",
                            messagingSenderId: "1028577806755",
                            appId: "1:1028577806755:web:f7216cac01d9290826f216",
                            measurementId: "G-E3MJJZHPPR",
                            databaseURL: "https://lazymice-web-game-default-rtdb.asia-southeast1.firebasedatabase.app"
                        };
                        
                        try {
                            firebase.initializeApp(firebaseConfig);
                            window.db = firebase.database();
                            window.auth = firebase.auth();
                        } catch (e) {
                            console.error("æ‰‹åŠ¨åˆå§‹åŒ–Firebaseå¤±è´¥:", e);
                        }
                    }
                    
                    // æ£€æŸ¥AdminPanel
                    if (typeof AdminPanel === 'undefined' || !window.adminPanel) {
                        console.warn("AdminPanelæœªå®šä¹‰æˆ–æœªåˆå§‹åŒ–ï¼Œå°è¯•é‡æ–°åŠ è½½");
                        
                        // åŠ¨æ€åŠ è½½admin.jsè„šæœ¬
                        const script = document.createElement('script');
                        script.src = 'scripts/admin.js';
                        script.onload = function() {
                            console.log("Adminè„šæœ¬å·²é‡æ–°åŠ è½½");
                            // åˆå§‹åŒ–adminPanel
                            if (typeof AdminPanel !== 'undefined') {
                                window.adminPanel = new AdminPanel();
                                window.adminPanel.init();
                                console.log("AdminPanelå·²æ‰‹åŠ¨åˆå§‹åŒ–");
                            }
                        };
                        document.head.appendChild(script);
                    }
                    
                    // æ£€æŸ¥userManager
                    if (typeof userManager === 'undefined' || userManager === null) {
                        console.error("userManageræœªå®šä¹‰!");
                        
                        // å°è¯•æ‰‹åŠ¨åˆ›å»ºuserManager
                        window.userManager = new UserManager();
                        
                        if (typeof userManager !== 'undefined') {
                            // æ‰‹åŠ¨åˆå§‹åŒ–
                            userManager.init();
                        }
                    }
                    
                    // æ£€æŸ¥å…¶ä»–ç®¡ç†å™¨
                    if (typeof canvasManager === 'undefined' || canvasManager === null) {
                        console.error("canvasManageræœªå®šä¹‰!");
                        
                        // å°è¯•æ‰‹åŠ¨åˆ›å»º
                        window.canvasManager = new CanvasManager();
                        canvasManager.init();
                    }
                    
                    if (typeof adminPanel === 'undefined' || adminPanel === null) {
                        console.error("adminPanelæœªå®šä¹‰!");
                        
                        // å¦‚æœAdminPanelç±»å·²å®šä¹‰ä½†å®ä¾‹æœªåˆ›å»º
                        if (typeof AdminPanel !== 'undefined') {
                            // å°è¯•æ‰‹åŠ¨åˆ›å»º
                            window.adminPanel = new AdminPanel();
                            window.adminPanel.init();
                            console.log("adminPanelå·²æ‰‹åŠ¨åˆ›å»ºå’Œåˆå§‹åŒ–");
                        }
                    }
                } catch (error) {
                    console.error("åˆå§‹åŒ–æ£€æŸ¥å¤±è´¥:", error);
                }
            }, 1000);
        });
    </script>

    <!-- ä¸´æ—¶æ•°æ®æ¸…ç†è„šæœ¬ - éœ€è¦æ—¶å–æ¶ˆä¸‹é¢çš„æ³¨é‡Šï¼Œä½¿ç”¨åè¯·æ¢å¤æ³¨é‡ŠçŠ¶æ€ -->
     <script src="delete-data.js"></script> 
</body>
</html> 